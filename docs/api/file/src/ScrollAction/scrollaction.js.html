<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/ScrollAction/scrollaction.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Accordion</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-expand">expand</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Helper</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-elementSize">elementSize</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-eventTrigger">eventTrigger</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">ScrollAction</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ScrollAction/container.js~Container.html">Container</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ScrollAction/container.js~ParentContainer.html">ParentContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ScrollAction/container.js~TargetContainer.html">TargetContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ScrollAction/container.js~WindowContainer.html">WindowContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lazyaction">lazyaction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lazyimage">lazyimage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onBottom">onBottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onScroll">onScroll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-onTop">onTop</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stickyheader">stickyheader</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">Storage</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-clear">clear</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getItem">getItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hasItem">hasItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-keys">keys</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeItem">removeItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setItem">setItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-supported">supported</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/ScrollAction/scrollaction.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { Container } from &apos;./container&apos;

const win = document.defaultView

/**
 * Detect scroll events for elements
 */
export function onScroll (preprocess, process, postprocess) {
  return function (parentSelector, targetSelector, ...args) {
    const container = new Container(parentSelector, targetSelector)
    const targets = container.children

    if (container.parents.length &lt;= 0 || targets.length &lt;= 0) return

    function scroll () {
      targets.forEach((target, index) =&gt; {
        const differenceX = Math.abs(container.window.scrollOrigin.x - target.positionOrigin.x)
        const differenceY = Math.abs(container.window.scrollOrigin.y - target.positionOrigin.y)

        if (container.window.rect.width * 1.1 &gt; differenceX &amp;&amp;
            container.window.rect.height * 1.1 &gt; differenceY) {
          preprocess(target.element, ...args)
          process(target.element, ...args)
          postprocess(target.element, ...args)
          targets.splice(index, 1)  // Remove an item from targets by side effect
          if (targets.length &lt;= 0) container.off(&apos;scroll&apos;, scroll)
        }
      })
    }

    function overflowX () {
      targets.forEach((target, index) =&gt; {
        const differenceX = Math.abs(target.parent.scrollOrigin.x - target.positionOrigin.x)
        const differenceY =
          Math.abs(container.window.scrollOrigin.y - target.parent.positionOrigin.y)

        if (target.parent.rect.width * 1.1 &gt; differenceX &amp;&amp;
            container.window.rect.height * 1.1 &gt; differenceY) {
          preprocess(target.element, ...args)
          process(target.element, ...args)
          postprocess(target.element, ...args)
          targets.splice(index, 1)  // Remove an item from targets by side effect
          if (targets.length &lt;= 0) container.off(&apos;scroll&apos;, overflowX)
        }
      })
    }

    function overflowY () {
      targets.forEach((target, index) =&gt; {
        const differenceX =
          Math.abs(container.window.scrollOrigin.x - target.parent.positionOrigin.x)
        const differenceY = Math.abs(target.parent.scrollOrigin.y - target.positionOrigin.y)

        if (container.window.rect.width * 1.1 &gt; differenceX &amp;&amp;
            target.parent.rect.height * 1.1 &gt; differenceY) {
          preprocess(target.element, ...args)
          process(target.element, ...args)
          postprocess(target.element, ...args)
          targets.splice(index, 1)  // Remove an item from targets by side effect
          if (targets.length &lt;= 0) container.off(&apos;scroll&apos;, overflowY)
        }
      })
    }

    if (toString.apply(container.parents[0].element) === &apos;[object Window]&apos;) {
      container.on(&apos;scroll&apos;, scroll)
      scroll()
    } else if (container.parents[0].rect.width &lt; container.parents[0].rect.scrollWidth) {
      container.on(&apos;scroll&apos;, overflowX)
      overflowX()
    } else if (container.parents[0].rect.height &lt; container.parents[0].rect.scrollHeight) {
      container.on(&apos;scroll&apos;, overflowY)
      overflowY()
    }
  }
}

/**
 * Detect elements on top of window
 */
export function onTop (preprocess, process, postprocess) {
  return function (selector, ...args) {
    const elements = document.querySelectorAll(selector)

    elements.forEach((element) =&gt; {
      const elementRect = element.getBoundingClientRect()
      const elementPositionY = Math.floor(elementRect.top) + (win.scrollY || win.pageYOffset)
      const elementOriginY = elementRect.height + elementPositionY

      function scroll () {
        const windowScrollY = win.scrollY || win.pageYOffset

        if (elementOriginY &lt;= windowScrollY) {
          const processArgs = [element, false].concat(args)
          process(...processArgs)
          postprocess(...processArgs)
        } else {
          const processArgs = [element, true].concat(args)
          process(...processArgs)
          postprocess(...processArgs)
        }
      }

      preprocess(...[element].concat(args))
      win.addEventListener(&apos;scroll&apos;, scroll, false)
      scroll()

      return element
    })
  }
}

/**
 *
 */
export function onBottom (preprocess, process, postprocess) {
  return function (selector, ...args) {
    const processArgs = [selector].concat(args)
    preprocess(...processArgs)
    process(...processArgs)
    postprocess(...processArgs)
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
